<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wwcai.crm.workbench.dao.ClueDao">

    <delete id="delete1">
        delete from tbl_clue
        where id=#{id}
    </delete>

     <delete id="delete">
         delete from tbl_clue
         where id in
         <foreach collection="array" item="id" open="(" close=")"
                  separator=",">
             #{id}
         </foreach>
     </delete>


     <update id="update">
         update  tbl_clue set
             fullname=#{fullname},
             appellation=#{appellation},
             owner=#{owner},
             company=#{company},
             job=#{job},
             email=#{email},
             phone=#{phone},
             website=#{website},
             mphone=#{mphone},
             state=#{state},
             source=#{source},
             editBy=#{editBy},
             editTime=#{editTime},
             description=#{description},
             contactSummary=#{contactSummary},
             nextContactTime=#{nextContactTime},
             address=#{address}
         where id=#{id}
     </update>

     <select id="getClueById" resultType="clue">
         select * from tbl_clue where id=#{id}
     </select>

     <select id="detail" resultType="clue">

          select
            c.id,
            c.fullname,
            u.name as owner,
            c.appellation,
            c.company,
            c.phone,
            c.email,
            c.website,
            c.mphone,
            c.source,
            c.state,
            c.job,
            c.createTime,
            c.createBy,
            c.editTime,
            c.editBy,
            c.description,
	        c.contactSummary,
            c.nextContactTime,
            c.address
            from tbl_clue c
            join tbl_user u
            on c.owner = u.id
            where c.id=#{id}
     </select>


     <select id="getClueListByCondition" resultType="clue">

        select
            c.id,
            c.fullname,
            u.name as owner,
            c.appellation,
            c.company,
            c.phone,
            c.mphone,
            c.source,
            c.state
            from tbl_clue c
            join tbl_user u
            on c.owner = u.id
               <where>

                    <if test="fullname != null and fullname != ''">
                         and c.fullname like '%' #{fullname} '%'
                    </if>

                    <if test="owner != null and owner != ''">
                         and u.name like '%' #{owner} '%'
                    </if>

                    <if test="company != null and company != ''">
                         and c.company like '%' #{company} '%'
                    </if>

                    <if test="source != null and source != ''">
                         and c.source like '%' #{source} '%'
                    </if>

                    <if test="state != null and state != ''">
                         and c.state like '%' #{state} '%'
                    </if>

                    <if test="phone != null and phone != ''">
                         and c.phone =#{phone}
                    </if>

                    <if test="mphone != null and mphone != ''">
                         and c.mphone =#{mphone}
                    </if>


               </where>


          order by c.createTime desc

          limit #{skipCount}, #{pageSize}
     </select>

     <select id="getTotalByCondition" resultType="int">
          select count(*)
          from tbl_clue c
          join tbl_user u
          on c.owner = u.id
          <where>

               <if test="fullname != null and fullname != ''">
                    and c.fullname like '%' #{fullname} '%'
               </if>

               <if test="owner != null and owner != ''">
                    and u.owner like '%' #{owner} '%'
               </if>

               <if test="company != null and company != ''">
                    and c.company like '%' #{company} '%'
               </if>

               <if test="source != null and source != ''">
                    and c.source like '%' #{source} '%'
               </if>

               <if test="state != null and state != ''">
                    and c.state like '%' #{state} '%'
               </if>

               <if test="phone != null and phone != ''">
                    and c.phone =#{phone}
               </if>

               <if test="mphone != null and mphone != ''">
                    and c.mphone =#{mphone}
               </if>

          </where>
     </select>

	<insert id="save" >

        insert into tbl_clue(
             id	,
             fullname,
             appellation,
             owner,
             company,
             job,
             email,
             phone,
             website,
             mphone,
             state,
             source,
             createBy,
             createTime,
             description,
             contactSummary,
             nextContactTime,
             address
        ) values(

             #{id},
             #{fullname},
             #{appellation},
             #{owner},
             #{company},
             #{job},
             #{email},
             #{phone},
             #{website},
             #{mphone},
             #{state},
             #{source},
             #{createBy},
             #{createTime},
             #{description},
             #{contactSummary},
             #{nextContactTime},
             #{address}

        )
    </insert>
  	
</mapper>

































